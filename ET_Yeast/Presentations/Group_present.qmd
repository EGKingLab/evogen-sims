---
title: "Predicting phenotypic and genotypic evolution given fluctuating selection"
author: "Esdras T"
format: 
  revealjs:
    standalone: true
    self-contained: true
    slide-number: true
    show-slide-number: all
editor: visual
---

```{r, echo=FALSE, message=FALSE}
library(tidyverse)
library(stringr)
library(cowplot)
theme_set(theme_cowplot())
```

```{r, echo=FALSE, message=FALSE}
mytheme <- function(){
  theme_set(theme_cowplot())+
    theme(axis.title = element_text(face = "bold"),
          axis.text = element_text(face = "italic"),
          plot.title = element_text(hjust = 0.5),
          legend.position = "none")
}
```

## Introduction

```{r,fig.width=12, fig.height=8, echo=FALSE}
library(knitr)
images <- c("~/YeastProj.dir/evogen-sims/ET_Yeast/Presentations/Images.dir/Happy_summer_humans.png", "~/YeastProj.dir/evogen-sims/ET_Yeast/Presentations/Images.dir/Sad_winter_humans.png")

include_graphics(images)

 opts_chunk$set(fig.show = "hold", fig.align = "center", out.width = "25%", out.height = "25%")
```

## Introduction

```{r,fig.width=12, fig.height=8, echo=FALSE}
library(knitr)
images <- c("~/YeastProj.dir/evogen-sims/ET_Yeast/Presentations/Images.dir/Happy_summer_humans.png", "~/YeastProj.dir/evogen-sims/ET_Yeast/Presentations/Images.dir/Sad_winter_humans.png", "~/YeastProj.dir/evogen-sims/ET_Yeast/Presentations/Images.dir/Happy_fruit_fly.png", "~/YeastProj.dir/evogen-sims/ET_Yeast/Presentations/Images.dir/Angry_winter_fruit_fly.png")

include_graphics(images)

opts_chunk$set(fig.show = "hold", fig.align = "center", out.width = "25%", out.height = "25%")
```

## Introduction


![](/home/etb68/YeastProj.dir/evogen-sims/ET_Yeast/Presentations/Images.dir/Happy_summer_humans.png){fig-align="center" height="80"}

![](/home/etb68/YeastProj.dir/evogen-sims/ET_Yeast/Presentations/Images.dir/Sad_winter_humans.png){fig-align="center" height="80"}

## Introduction


![](/home/etb68/YeastProj.dir/evogen-sims/ET_Yeast/Presentations/Images.dir/Allele_Change.png){fig-align="center" height="80"}

Allele Frequency change at seasonal SNPs


## Aims

-   Develop a polygenic model that accurately predicts genotypic and phenotypic evolution featuring fluctuating selection

## Genome

![](/home/etb68/YeastProj.dir/evogen-sims/ET_Yeast/Presentations/GenomeSLiM_Image.png){fig-align="center" height="80"}

## Genome

![](/home/etb68/YeastProj.dir/evogen-sims/ET_Yeast/Presentations/GenomeSLiM_Image.png){fig-align="center" height="80"}

-   Phenotype is the sum of all alleles' effect plus random noise

## Parameters

WF model with 5 replicates each having the following parameters:

-   Heritability: 0.1, 0.5, and 0.8

## Parameters

WF model with 5 replicates each having the following parameters:

-   Heritability: 0.1, 0.5, and 0.8
-   Loci numbers: 1, 10, 70, 100, 300

## Parameters

WF model with 5 replicates each having the following parameters:

-   Heritability: 0.1, 0.5, and 0.8
-   Loci numbers: 1, 10, 70, 100, 300
-   Standard deviations: 1, 2, 3, 4

## Parameters

WF model with 5 replicates each having the following parameters:

-   Heritability: 0.1, 0.5, and 0.8
-   Loci numbers: 1, 10, 70, 100, 300
-   Standard deviations: 1, 2, 3, 4
-   Generation interval (GI): 10, 20, 30 (Linear changes)

## Parameters

WF model with 5 replicates each having the following parameters:

-   Heritability: 0.1, 0.5, and 0.8
-   Loci numbers: 1, 10, 70, 100, 300
-   Standard deviations: 1, 2, 3, 4
-   Generation interval (GI): 10, 20, 30 (Linear changes)
-   GI: sinusoidal1 (20) and sinusoidal2 (5, 10, 15, 30)

## Models

-   Neutral selection

-   Constant selection

-   Fluctuating selection(Linear & Sinusoidal)

## Fitness Function

$$
\text{Fitness} = \exp\left(-\frac{1}{{\text{phenotype}}} \times (\text{phenotype} - \text{optimum})^2\right)
$$

-   Optimum = mean(phenotype) ± nSD

## Fitness Function

$$
\text{Fitness} = \exp\left(-\frac{1}{{\text{phenotype}}} \times (\text{phenotype} - \text{optimum})^2\right)
$$

-   Optimum = mean(phenotype) ± nSD

```{r,fig.width=12, fig.height=8, echo=FALSE}
Generation <- seq(1, 100)
Optimum <- seq(90, 110, length.out = 100)
df <- data.frame(Generation, Optimum)

p1 <- ggplot(df) + 
  geom_blank(aes(Generation, Optimum)) +
  geom_hline(yintercept = 100, color = "darkred")+
  annotate("text", x = 50, y = 100, label = "Mean Phenotype", size = 3, vjust = -1.5, col = "darkred")+
  geom_hline(yintercept = 105)+
annotate("text", x = 50, y = 105, label = "Optium", size = 3, vjust = -1.5, col = "black")+
  labs(x = NULL, y = NULL)+ # title = "Constant Optimum", 
  mytheme()

Opti_Gen <- tibble(Generation = seq(1:100),
                   Optimum = rep(c(rep(110, 10), rep(90, 10)), 5))

mu_pheno = mean(Opti_Gen$Optimum)

Opt_Data <- Opti_Gen %>% 
  filter(Generation == 0 | Generation %% 10 == 0)

p2 <- Opt_Data %>% 
  ggplot(aes(x = Generation, y = Optimum))+
  geom_line()+
  geom_hline(yintercept = mu_pheno, col = "darkred")+
  annotate("text", x = 50, y = mu_pheno, label = "Mean Phenotype", size = 3, vjust = -1.5, col = "darkred")+
  labs(x = NULL, y = NULL)+ # title = "Fluctuating Linear Opimum", 
  mytheme()

Generation <- seq(1, 100, length.out = 400) 
Optimum <- 100 + 10 *sin(2 * pi* Generation / 25) 
df <- data.frame(Generation, Optimum) 

p3 <- ggplot(df) + 
  geom_line(aes(Generation, Optimum)) + 
  geom_hline(yintercept = mean(Optimum), color = "darkred")+ 
  annotate("text", x = 50, y = 100, label = "Mean Phenotype", size = 3, vjust = -1.5, col = "darkred")+ 
  labs( x = NULL, y = NULL)+ # title = "Sinusoidal I Period",
  mytheme()

Generation <- seq(1, 100, length.out = 400)

Optimum <- 100 + 10 * sin(2 * pi * Generation / 25) + 2 * sin(2 * pi * Generation / 10) + 5 * sin(2 * pi * Generation / 5) + 1 * sin(2 * pi * Generation / 2)

df <- data.frame(Generation, Optimum)

p4 <- ggplot(df) + 
  geom_line(aes(Generation, Optimum)) +
  geom_hline(yintercept = mean(Optimum), color = "darkred")+
  annotate("text", x = 50, y = 100, label = "Mean Phenotype", size = 3, vjust = -1.5, col = "darkred")+
  labs(x = NULL, y = NULL)+ #title = "Sinusoidal IV Periods",
  mytheme()


 mygrid <- plot_grid(p1, p2, p3, p4, labels = "AUTO", label_size = 10,label_colour = NULL, label_x = 0.15, label_y = 1.02, hjust = -0.5, vjust = 1.5, scale = 1,ncol = 2, align = "hv") +
  theme(plot.margin = margin(t = 10, r = 10, b = 10, l = 10)) +
  draw_label("Generation", size = 12, x = 0.5, y = -0.0105, hjust = .3, fontface = "bold")+
  draw_label("Optimum", size = 12, x = -0.01, y = 0.5, vjust = 0.5, angle = 90, fontface = "bold")
 mygrid
```

## Genotype file

```{r, echo=FALSE}
mygeno <- read.csv("~/YeastProj.dir/evogen-sims/ET_Yeast/output.dir/Selection_Models/WF.dir/LinFS.dir/genome1_n100_H0.5SD3Gen30.csv") %>% dplyr::select(-Origin)
knitr::kable(head(mygeno))
```

## Phenotype file

```{r, echo=FALSE}
mypheno <- read.csv("~/YeastProj.dir/evogen-sims/ET_Yeast/output.dir/Selection_Models/WF.dir/LinFS.dir/MeanPhenotypes1_n100_H0.5SD3Gen30.csv")
knitr::kable(head(mypheno))
```

## Alle Frequency (single plot FS)

```{r ,fig.width=12, fig.height=8, echo=FALSE}
mygeno %>% ggplot(aes(Generation, Frequency, color = as.character(Position)))+
  geom_line(linewidth = 0.2)+
  ggtitle("Alle freq plot h2 = 0.5, sd = 3 for 30 Generations")+
  mytheme()
```

## Allele Frequency (single model)

```{r,fig.width=12, fig.height=8, echo=FALSE}
source("~/YeastProj.dir/evogen-sims/ET_Yeast/Code/Selection_Models/WF.dir/Plotting/PrelimVisualSelect.R")
dir_path <- "~/YeastProj.dir/evogen-sims/ET_Yeast/output.dir/Selection_Models/WF.dir/LinFS.dir/"
pattern <- "^genome.*0\\.5SD3Gen30\\.csv$"
ncol <- 3

plot_files(dir_path, pattern, ncol = ncol)
```

## Mean Allele Frequency (all variables)

```{r,fig.width=12, fig.height=8, echo=FALSE}
source("~/YeastProj.dir/evogen-sims/ET_Yeast/Presentations/DataPhilesCode.R")
dir_path <- "~/YeastProj.dir/evogen-sims/ET_Yeast/output.dir/Selection_Models/WF.dir/LinFS.dir/"
pattern <- "^genome\\d+_n100_H0[.5]+SD\\d+Gen\\d+\\.csv$"
output_dir <- "~/YeastProj.dir/evogen-sims/ET_Yeast/output.dir/Selection_Models/WF.dir/Plots.dir/LinFS.dir/Frequency/"
allele_feq_fx(dir_path, pattern, output_dir)
```

## Phenotypes (single plot FS)

```{r,fig.width=12, fig.height=8, echo=FALSE, message=FALSE}
mypheno %>% ggplot(aes(Generation, Phenotype))+
  geom_line(linewidth = 0.2)+
  ggtitle("Phenotype plot h2 = 0.5, sd = 3 for 30 Generations")+
  mytheme()
```

## Phenotypes (single model)

```{r,fig.width=12, fig.height=8, echo=FALSE, message=FALSE}
source("~/YeastProj.dir/evogen-sims/ET_Yeast/Code/Selection_Models/WF.dir/Plotting/PrelimVisualSelect.R")
dir_path <- "~/YeastProj.dir/evogen-sims/ET_Yeast/output.dir/Selection_Models/WF.dir/LinFS.dir/"
pattern <- "^MeanPhenotypes.*0\\.5SD3Gen30\\.csv$"
ncol <- 3

Pheno_files(dir_path, pattern, ncol)
```

## Phenotypes (all variables)

```{r, fig.width=12, fig.height=8, echo=FALSE, message=FALSE}
source("~/YeastProj.dir/evogen-sims/ET_Yeast/Presentations/DataPhilesCode.R")
dir_path <- "~/YeastProj.dir/evogen-sims/ET_Yeast/output.dir/Selection_Models/WF.dir/LinFS.dir/"
pattern <- "^MeanPhenotypes\\d+_n100+_H0[.5]+SD\\d+Gen\\d+\\.csv$"
output_dir <- "~/YeastProj.dir/evogen-sims/ET_Yeast/output.dir/Selection_Models/WF.dir/Plots.dir/LinFS.dir/Phenotypes/"
pheno_fx(dir_path, pattern, output_dir)

```

